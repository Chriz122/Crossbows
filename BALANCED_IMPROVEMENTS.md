# ðŸŽ¯ ç¬¬å››éšŽæ®µï¼šå¹³è¡¡æ”¹é€² - è§£æ±ºéŽæ“¬åˆå•é¡Œ

## ðŸ“Š ç•¶å‰ç‹€æ³åˆ†æž

### âœ… æˆåŠŸéƒ¨åˆ†
- Yaw èƒ½è·Ÿéš¨è¶¨å‹¢è®ŠåŒ–
- Pitch æ•´é«”è·Ÿéš¨è‰¯å¥½
- Roll è¨“ç·´é›†å¹¾ä¹Žå®Œç¾Ž

### âŒ é—œéµå•é¡Œï¼šéŽæ“¬åˆ ðŸ”´

**ç—‡ç‹€**:
- **è¨“ç·´é›†æ•ˆæžœæ¥µå¥½** (Train åœ–)
- **æ¸¬è©¦é›†æ•ˆæžœå·®** (Predict åœ–)
- **é æ¸¬éŽåº¦å¹³æ»‘**ï¼Œç„¡æ³•æ•æ‰çœŸå¯¦å€¼çš„å¿«é€Ÿè®ŠåŒ–

**è¨ºæ–·**: å…¸åž‹çš„éŽæ“¬åˆï¼æ¨¡åž‹è¨˜ä½äº†è¨“ç·´æ•¸æ“šï¼Œä½†ç„¡æ³•æ³›åŒ–åˆ°æ–°æ•¸æ“šã€‚

---

## ðŸŽ¯ æ ¸å¿ƒæ”¹é€²ç­–ç•¥

### æ”¹é€² 1: **é™ä½Žæ¨¡åž‹è¤‡é›œåº¦** â­â­â­

#### åƒæ•¸å°æ¯”

| é …ç›® | ç¬¬ä¸‰ç‰ˆ (éŽæ“¬åˆ) | ç¬¬å››ç‰ˆ (å¹³è¡¡) | èªªæ˜Ž |
|------|----------------|---------------|------|
| **hidden_size** | 640 | **512** | -20% å®¹é‡ |
| **num_layers** | 4 | **3** | -25% å±¤æ•¸ |
| **fc_layers** | 6å±¤ | **5å±¤** | æ¸›å°‘æ·±åº¦ |
| **fc_start** | 1024 | **768** | -25% èµ·å§‹å¯¬åº¦ |
| **dropout** | 0.1 | **0.25** | +150% æ­£å‰‡åŒ– |

**ç‚ºä»€éº¼ï¼Ÿ**
```
æ¨¡åž‹å¤ªå¤§ â†’ è¨˜æ†¶è¨“ç·´æ•¸æ“š â†’ éŽæ“¬åˆ
æ¨¡åž‹é©ä¸­ + é«˜ Dropout â†’ å­¸ç¿’é€šç”¨æ¨¡å¼ â†’ å¥½æ³›åŒ–
```

---

### æ”¹é€² 2: **æ›´å¼·çš„æ­£å‰‡åŒ–** â­â­â­

```python
# ç¬¬ä¸‰ç‰ˆ (éŽæ–¼æ¿€é€²)
lr = 0.003
weight_decay = 0.005  # å¤ªä½Ž
dropout = 0.1  # å¤ªä½Ž

# ç¬¬å››ç‰ˆ (å¹³è¡¡)
lr = 0.0015  # é™ä½Ž50%
weight_decay = 0.015  # å¢žåŠ 3å€ï¼
dropout = 0.25  # å¢žåŠ 2.5å€ï¼
```

**ä¸‰é‡æ­£å‰‡åŒ–**:
1. **Weight Decay**: æ‡²ç½°å¤§æ¬Šé‡
2. **Dropout**: éš¨æ©Ÿä¸Ÿæ£„ç¥žç¶“å…ƒ
3. **Lower LR**: æ›´ç©©å®šçš„å­¸ç¿’

---

### æ”¹é€² 3: **æ¸›å°‘æ•¸æ“šå¢žå¼·å¼·åº¦** â­â­

```python
# ç¬¬ä¸‰ç‰ˆ (éŽåº¦å¢žå¼·)
noise_level = 0.015
å¢žå¼·æ–¹å¼: å™ªéŸ³ + ç¸®æ”¾
æ•¸æ“šé‡: Ã— 3 (24000 æ¨£æœ¬)

# ç¬¬å››ç‰ˆ (è¼•é‡å¢žå¼·)
noise_level = 0.008  # é™ä½Ž47%
å¢žå¼·æ–¹å¼: åªæœ‰å™ªéŸ³
æ•¸æ“šé‡: Ã— 2 (16000 æ¨£æœ¬)
```

**ç‚ºä»€éº¼æ¸›å°‘ï¼Ÿ**
- éŽåº¦å¢žå¼· â†’ è¨“ç·´åˆ†å¸ƒèˆ‡æ¸¬è©¦ä¸åŒ â†’ æ³›åŒ–å·®
- è¼•é‡å¢žå¼· â†’ ä¿æŒåˆ†å¸ƒç›¸ä¼¼ â†’ æ³›åŒ–å¥½

---

### æ”¹é€² 4: **å¹³è¡¡æå¤±å‡½æ•¸** â­â­

```python
# ç¬¬ä¸‰ç‰ˆ (éŽæ–¼æ¿€é€²)
Loss = MSE
lambda_velocity = 0.1
lambda_magnitude = 1.5  # å¤ªæ¿€é€²ï¼

# ç¬¬å››ç‰ˆ (å¹³è¡¡)
Loss = SmoothL1  # æ›´ç©©å¥
lambda_velocity = 0.2  # å¢žåŠ 
lambda_magnitude = 0.5  # é™ä½Ž70%ï¼
```

**æ”¹è®ŠåŽŸå› **:
- å¹…åº¦æ‡²ç½°å¤ªå¤§ â†’ å¼·è¿«é æ¸¬å¤§å€¼ â†’ åœ¨è¨“ç·´é›†æœ‰æ•ˆä½†æ¸¬è©¦é›†å¤±æ•ˆ
- é™ä½Žæ‡²ç½° â†’ è®“æ¨¡åž‹è‡ªç„¶å­¸ç¿’ â†’ æ›´å¥½æ³›åŒ–

---

### æ”¹é€² 5: **æ¸›å°‘è¨“ç·´è¼ªæ•¸** â­

```python
epochs = 2000  # å¾ž 3000 é™ä½Ž
T_0 = 40  # å¾ž 30 å¢žåŠ  (æ›´é•·çš„å­¸ç¿’é€±æœŸ)
```

**ç‚ºä»€éº¼ï¼Ÿ**
- è¨“ç·´å¤ªä¹… â†’ éŽåº¦æ“¬åˆè¨“ç·´æ•¸æ“š
- é©ç•¶è¨“ç·´ â†’ ä¿ç•™æ³›åŒ–èƒ½åŠ›

---

## ðŸ“ˆ å®Œæ•´åƒæ•¸å°æ¯”

| é …ç›® | ç¬¬ä¸‰ç‰ˆ (æ¿€é€²) | ç¬¬å››ç‰ˆ (å¹³è¡¡) | è®ŠåŒ– |
|------|---------------|---------------|------|
| **hidden_size** | 640 | **512** | -20% |
| **num_layers** | 4 | **3** | -25% |
| **fc_neurons** | [1024,768,512,256,128,3] | **[768,512,256,128,3]** | -25% |
| **dropout** | 0.1 | **0.25** | +150% |
| **å­¸ç¿’çŽ‡** | 0.003 | **0.0015** | -50% |
| **weight_decay** | 0.005 | **0.015** | +200% |
| **æ•¸æ“šå¢žå¼·** | Ã— 3 | **Ã— 2** | -33% |
| **noise_level** | 0.015 | **0.008** | -47% |
| **lambda_vel** | 0.1 | **0.2** | +100% |
| **lambda_mag** | 1.5 | **0.5** | -67% |
| **Loss** | MSE | **SmoothL1** | æ›´ç©©å¥ |
| **epochs** | 3000 | **2000** | -33% |
| **T_0** | 30 | **40** | +33% |

---

## ðŸ”¬ ç‚ºä»€éº¼æœƒéŽæ“¬åˆï¼Ÿ

### åŽŸå›  1: æ¨¡åž‹å¤ªå¤§
```
640 hidden Ã— 4 layers Ã— 6 FC layers = å·¨å¤§å®¹é‡
å·¨å¤§å®¹é‡ + å¤§ç¯„åœæ•¸æ“š = è¨˜æ†¶æ¯å€‹ç´°ç¯€
```

### åŽŸå›  2: æ­£å‰‡åŒ–ä¸è¶³
```
dropout = 0.1 â†’ ä¿ç•™ 90% ç¥žç¶“å…ƒ â†’ å¤ªå¤š
weight_decay = 0.005 â†’ æ‡²ç½°å¤ªè¼• â†’ æ¬Šé‡éŽå¤§
```

### åŽŸå›  3: æ•¸æ“šå¢žå¼·éŽåº¦
```
Ã— 3 æ•¸æ“š + å¼·å™ªéŸ³ â†’ è¨“ç·´åˆ†å¸ƒæ”¹è®Š
æ¸¬è©¦æ•¸æ“šæ²’å¢žå¼· â†’ åˆ†å¸ƒä¸åŒ¹é… â†’ æ³›åŒ–å·®
```

### åŽŸå›  4: å¹…åº¦æ‡²ç½°å¤ªæ¿€é€²
```
lambda = 1.5 â†’ å¼·è¿«é æ¸¬å¤§å€¼
è¨“ç·´é›†: è¢«è¿«é æ¸¬å¤§ â†’ ç¬¦åˆæ‡²ç½° â†’ loss ä½Ž
æ¸¬è©¦é›†: çœŸå¯¦éœ€æ±‚ä¸åŒ â†’ é æ¸¬å¤±æ•—
```

---

## ðŸŽ¯ å¹³è¡¡å“²å­¸

### æ ¸å¿ƒæ€æƒ³
```
è¨“ç·´æ•ˆæžœ âš–ï¸ æ³›åŒ–èƒ½åŠ›
   â†“              â†“
è¨˜æ†¶ç´°ç¯€      å­¸ç¿’æ¨¡å¼
   â†“              â†“
  å·®æ³›åŒ–       å¥½æ³›åŒ–
```

### å¹³è¡¡ç­–ç•¥
1. **é©åº¦å®¹é‡**: è¶³å¤ å­¸ç¿’ï¼Œä¸éŽåº¦è¨˜æ†¶
2. **å¼·æ­£å‰‡åŒ–**: é˜²æ­¢éŽæ“¬åˆ
3. **è¼•é‡å¢žå¼·**: ä¿æŒåˆ†å¸ƒä¸€è‡´
4. **å¹³è¡¡æå¤±**: ä¸éŽåº¦è¿½æ±‚å–®ä¸€ç›®æ¨™

---

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### 1ï¸âƒ£ é‡æ–°è¨“ç·´

```powershell
cd c:\Users\USER\Desktop\Crossbows
python cnn_lstm/train.py
```

**è¨“ç·´ç‰¹é»ž**:
- â±ï¸ **æ™‚é–“**: 25-45 åˆ†é˜ï¼ˆæ¸›å°‘äº†33%ï¼‰
- ðŸ’ª **æ•¸æ“š**: 16,000 æ¨£æœ¬ï¼ˆæ¸›å°‘äº†33%ï¼‰
- ðŸ›¡ï¸ **æ­£å‰‡åŒ–**: å¼·åŠ› (dropout=0.25, wd=0.015)
- ðŸ“Š **æ¨¡åž‹**: 512 hidden, 3 layers, 5 FC
- âš–ï¸ **å¹³è¡¡**: è¨“ç·´æ•ˆæžœ vs æ³›åŒ–èƒ½åŠ›

### 2ï¸âƒ£ ç›£æŽ§è¨“ç·´

é—œæ³¨ train_loss vs test_loss çš„å·®è·ï¼š

```
âœ… å¥½çš„è¨“ç·´
epoch:500, train_loss:0.045, test_loss:0.055  (å·®è· 0.01)
epoch:1000, train_loss:0.035, test_loss:0.042  (å·®è· 0.007)
â†’ å·®è·å°ï¼Œæ³›åŒ–å¥½

âŒ éŽæ“¬åˆ
epoch:500, train_loss:0.025, test_loss:0.080  (å·®è· 0.055)
epoch:1000, train_loss:0.015, test_loss:0.095  (å·®è· 0.080)
â†’ å·®è·å¤§ï¼ŒéŽæ“¬åˆ
```

### 3ï¸âƒ£ é æ¸¬

```powershell
python cnn_lstm/predict.py
```

---

## ðŸŽ¯ é æœŸæ•ˆæžœ

| æŒ‡æ¨™ | ç¬¬ä¸‰ç‰ˆ | ç¬¬å››ç‰ˆç›®æ¨™ | æ”¹å–„ |
|------|--------|------------|------|
| **Trainç²¾åº¦** | æ¥µé«˜ | **é«˜** | é©åº¦ä¸‹é™ âœ… |
| **Predictç²¾åº¦** | å·® | **é«˜** | ðŸš€ å¤§å¹…æå‡ |
| **éŽæ“¬åˆç¨‹åº¦** | åš´é‡ | **è¼•å¾®** | ðŸš€ -80% |
| **Rollå¹³æ»‘åº¦** | å·® | **å¥½** | ðŸš€ æ•æ‰è®ŠåŒ– |
| **æ³›åŒ–èƒ½åŠ›** | å·® | **å¥½** | ðŸš€ æ ¸å¿ƒæ”¹å–„ |

---

## ðŸ“Š æŠ€è¡“æ·±åº¦åˆ†æž

### Dropout çš„ä½œç”¨

```python
# è¨“ç·´æ™‚ (dropout=0.25)
æ¯å€‹ç¥žç¶“å…ƒæœ‰ 25% æ©ŸçŽ‡è¢«ä¸Ÿæ£„
â†’ ç¶²çµ¡å¿…é ˆå­¸ç¿’å†—é¤˜è¡¨ç¤º
â†’ ä¸èƒ½ä¾è³´å–®ä¸€ç¥žç¶“å…ƒ
â†’ æå‡é­¯æ£’æ€§

# æ¸¬è©¦æ™‚ (model.eval())
Dropout è‡ªå‹•é—œé–‰
â†’ ä½¿ç”¨å®Œæ•´ç¶²çµ¡
â†’ ä½†å› è¨“ç·´æ™‚å­¸æœƒäº†å†—é¤˜
â†’ æ³›åŒ–èƒ½åŠ›å¼·
```

### Weight Decay çš„æ•¸å­¸

```python
# æ¨™æº–æ›´æ–°
Î¸_new = Î¸ - lr * âˆ‡L

# åŠ å…¥ Weight Decay
Î¸_new = Î¸ - lr * (âˆ‡L + wd * Î¸)
                      â†‘
                   æ‡²ç½°å¤§æ¬Šé‡

# æ•ˆæžœ
wd = 0.015 â†’ æ¯æ¬¡æ›´æ–°æ¸›å°‘ 1.5% æ¬Šé‡
â†’ é˜²æ­¢æ¬Šé‡éŽå¤§
â†’ æ¨¡åž‹æ›´ç°¡å–®
â†’ æ³›åŒ–æ›´å¥½
```

### æ•¸æ“šå¢žå¼·çš„å¹³è¡¡

```
å¢žå¼·å¼·åº¦ â†”ï¸ æ³›åŒ–æ•ˆæžœ
   â†“              â†“
ç„¡å¢žå¼· â†’ éŽæ“¬åˆ
è¼•é‡å¢žå¼· â†’ æœ€ä½³ â­
éŽåº¦å¢žå¼· â†’ åˆ†å¸ƒå¤±é… â†’ æ³›åŒ–å·®
```

---

## âš ï¸ æ½›åœ¨å•é¡Œ

### Q1: è¨“ç·´ç²¾åº¦ä¸‹é™å¤ªå¤š

**è§£æ±º**:
```python
# ç¨å¾®é™ä½Žæ­£å‰‡åŒ–
dropout = 0.2  # å¾ž 0.25 é™åˆ° 0.2
weight_decay = 0.01  # å¾ž 0.015 é™åˆ° 0.01
```

### Q2: æ¸¬è©¦ç²¾åº¦ä»ç„¶ä¸ç†æƒ³

**è§£æ±º**:
```python
# é€²ä¸€æ­¥é™ä½Žæ¨¡åž‹å®¹é‡
hidden_size = 384  # å¾ž 512 é™åˆ° 384
```

### Q3: æå¤±éœ‡ç›ª

**è§£æ±º**:
```python
# é€²ä¸€æ­¥é™ä½Žå­¸ç¿’çŽ‡
lr = 0.001  # å¾ž 0.0015 é™åˆ° 0.001
```

---

## ðŸ“š é—œéµå­¸ç¿’é»ž

### 1. éŽæ“¬åˆ vs æ¬ æ“¬åˆ

```
æ¬ æ“¬åˆ: train_loss é«˜, test_loss é«˜
   â†’ æ¨¡åž‹å¤ªç°¡å–®
   â†’ å¢žåŠ å®¹é‡

é©é…: train_loss ä½Ž, test_loss ä½Ž
   â†’ å‰›å‰›å¥½ â­

éŽæ“¬åˆ: train_loss æ¥µä½Ž, test_loss é«˜
   â†’ æ¨¡åž‹è¨˜æ†¶è¨“ç·´æ•¸æ“š
   â†’ å¢žåŠ æ­£å‰‡åŒ–
```

### 2. æ­£å‰‡åŒ–æ˜¯é—œéµ

```
Dropout: éš¨æ©Ÿä¸Ÿæ£„ â†’ å­¸ç¿’å†—é¤˜
Weight Decay: æ‡²ç½°å¤§æ¬Šé‡ â†’ ç°¡å–®æ¨¡åž‹
Lower LR: ç©©å®šå­¸ç¿’ â†’ é¿å…éŽåº¦å„ªåŒ–
```

### 3. æ•¸æ“šå¢žå¼·è¦é©åº¦

```
è¼•é‡å¢žå¼· > ç„¡å¢žå¼· > éŽåº¦å¢žå¼·
```

---

## ðŸ”„ è¿­ä»£ç­–ç•¥

å¦‚æžœæ•ˆæžœé‚„ä¸ç†æƒ³ï¼š

### æ–¹æ¡ˆ A: ç¹¼çºŒé™ä½Žå®¹é‡
```python
hidden_size = 384
num_layers = 2
fc_neurons = [512, 256, 128, 3]
```

### æ–¹æ¡ˆ B: æ¥µç«¯æ­£å‰‡åŒ–
```python
dropout = 0.3
weight_decay = 0.02
```

### æ–¹æ¡ˆ C: ä¸ä½¿ç”¨æ•¸æ“šå¢žå¼·
```python
# è¨»é‡‹æŽ‰å¢žå¼·ä»£ç¢¼
# train_X, train_y = augment_data(...)
```

### æ–¹æ¡ˆ D: Early Stopping
```python
patience = 50  # å¾ž 150 é™åˆ° 50
# æ›´æ—©åœæ­¢ï¼Œé¿å…éŽæ“¬åˆ
```

---

## âœ… ç¸½çµ

### æ ¸å¿ƒæ”¹é€²
1. âœ… **é™ä½Žå®¹é‡**: 512/3/5 (å¾ž 640/4/6)
2. âœ… **å¼·æ­£å‰‡åŒ–**: dropout=0.25, wd=0.015
3. âœ… **è¼•é‡å¢žå¼·**: Ã— 2 (å¾ž Ã— 3)
4. âœ… **å¹³è¡¡æå¤±**: mag=0.5 (å¾ž 1.5)
5. âœ… **æ¸›å°‘è¨“ç·´**: 2000 epochs (å¾ž 3000)

### å“²å­¸
```
ä¸è¿½æ±‚å®Œç¾Žçš„è¨“ç·´ç²¾åº¦
è¿½æ±‚å¹³è¡¡çš„æ³›åŒ–èƒ½åŠ› â­
```

### é æœŸ
- Train ç²¾åº¦ç•¥é™
- **Predict ç²¾åº¦å¤§å‡** ðŸš€
- éŽæ“¬åˆå•é¡Œè§£æ±º

---

**æ›´æ–°æ—¥æœŸ**: 2025å¹´11æœˆ1æ—¥  
**ç‰ˆæœ¬**: v4.0 (Balanced)  
**ç‹€æ…‹**: âœ… å¹³è¡¡å„ªåŒ–ï¼Œè§£æ±ºéŽæ“¬åˆ  
**æ ¸å¿ƒ**: æ³›åŒ– > è¨˜æ†¶
