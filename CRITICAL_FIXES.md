# ğŸ”¥ é—œéµå•é¡Œä¿®å¾©èªªæ˜

## âŒ ç™¼ç¾çš„åš´é‡å•é¡Œ

### å•é¡Œ 1: **æ¨™æº–åŒ–ä¸ä¸€è‡´** (æœ€åš´é‡)
**ç¾è±¡**: Predict åœ–ä¸­ Yaw å®Œå…¨æ˜¯å¹³çš„ï¼Œç„¡æ³•é æ¸¬

**åŸå› **:
```python
# âŒ predict.py çš„éŒ¯èª¤åšæ³•
feature_scaler = MinMaxScaler()
target_scaler = MinMaxScaler()
features = feature_scaler.fit_transform(features)  # é‡æ–° fitï¼
```

é€™æœƒå°è‡´ï¼š
- è¨“ç·´æ•¸æ“šçš„ç¯„åœ: Yaw [-50, 100]
- æ¸¬è©¦æ•¸æ“šçš„ç¯„åœ: Yaw [-10, 50]
- é‡æ–° fit å¾Œï¼Œæ¸¬è©¦æ•¸æ“šè¢«æ¨™æº–åŒ–åˆ°å®Œå…¨ä¸åŒçš„å°ºåº¦
- æ¨¡å‹çœ‹åˆ°çš„æ•¸å€¼å®Œå…¨éŒ¯èª¤ï¼Œç„¡æ³•æ­£ç¢ºé æ¸¬

**ä¿®å¾©**:
```python
# âœ… æ­£ç¢ºåšæ³•: è¼‰å…¥è¨“ç·´æ™‚ä¿å­˜çš„ scaler
import joblib
feature_scaler = joblib.load('RUN/train/feature_scaler.pkl')
target_scaler = joblib.load('RUN/train/target_scaler.pkl')
features = feature_scaler.transform(features)  # åª transform
```

### å•é¡Œ 2: **éŒ¯èª¤çš„å¹³ç§»æ“ä½œ**
```python
# âŒ éŒ¯èª¤
shift_amount = pred_inv[0]
pred_inv = pred_inv - shift_amount  # é€™æœƒè®“æ‰€æœ‰é æ¸¬å€¼å¾0é–‹å§‹
```

é€™å®Œå…¨ç ´å£äº†é æ¸¬çš„çµ•å°å€¼ï¼Œåªä¿ç•™ç›¸å°è®ŠåŒ–ã€‚

**ä¿®å¾©**: ç§»é™¤é€™æ®µä»£ç¢¼

### å•é¡Œ 3: **æ¨¡å‹å®¹é‡ä¸è¶³**
åŸå§‹åƒæ•¸å¤ªä¿å®ˆï¼š
- hidden_size: 256 â†’ **å¤ªå°**
- num_layers: 2 â†’ **å¤ªæ·º**
- dropout: 0.3 â†’ **å¤ªé«˜**

Yaw çš„å¤§ç¯„åœæ³¢å‹•ï¼ˆ-50åˆ°100ï¼‰éœ€è¦æ›´å¼·çš„è¡¨é”èƒ½åŠ›ã€‚

---

## âœ… å®Œæ•´ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾© 1: ä¿å­˜ä¸¦è¼‰å…¥ Scaler

**train.py æ–°å¢**:
```python
import joblib
# ä¿å­˜ scaler
joblib.dump(feature_scaler, Path('RUN/train/feature_scaler.pkl'))
joblib.dump(target_scaler, Path('RUN/train/target_scaler.pkl'))
```

**predict.py ä¿®æ”¹**:
```python
import joblib
# è¼‰å…¥è¨“ç·´æ™‚çš„ scaler
feature_scaler = joblib.load('RUN/train/feature_scaler.pkl')
target_scaler = joblib.load('RUN/train/target_scaler.pkl')
features = feature_scaler.transform(features)  # åª transformï¼Œä¸ fit
```

### ä¿®å¾© 2: å¢å¼·æ¨¡å‹å®¹é‡

```python
# æ–°åƒæ•¸ï¼ˆæ›´å¼·å¤§çš„æ¨¡å‹ï¼‰
hidden_size = 384      # 256 â†’ 384 (å¢åŠ 50%)
num_layers = 3         # 2 â†’ 3 (æ›´æ·±)
dropout = 0.2          # 0.3 â†’ 0.2 (ä¿ç•™æ›´å¤šä¿¡æ¯)
fc_neurons = [512, 256, 128, 64, 3]  # 5å±¤å…¨é€£æ¥
```

### ä¿®å¾© 3: å„ªåŒ–è¨“ç·´ç­–ç•¥

```python
# æ›´æ¿€é€²çš„è¨“ç·´
epochs = 2000          # 1000 â†’ 2000
batch_size = 256       # 128 â†’ 256 (åŠ é€Ÿè¨“ç·´)
lr = 0.001             # 0.0001 â†’ 0.001 (10å€å­¸ç¿’ç‡)
patience = 100         # 50 â†’ 100 (æ›´æœ‰è€å¿ƒ)

# æ·»åŠ å­¸ç¿’ç‡èª¿åº¦å™¨
scheduler = optim.lr_scheduler.ReduceLROnPlateau(
    optimizer, mode='min', factor=0.5, patience=20, verbose=True
)
```

### ä¿®å¾© 4: èª¿æ•´æå¤±æ¬Šé‡

```python
lambda_velocity = 0.3  # 0.5 â†’ 0.3
# é™ä½é€Ÿåº¦æ‡²ç½°ï¼Œè®“æ¨¡å‹æ›´é—œæ³¨ä½ç½®æº–ç¢ºæ€§
```

---

## ğŸ“Š åƒæ•¸å°æ¯”è¡¨

| é …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ | èªªæ˜ |
|------|--------|--------|------|
| **Scaler** | âŒ é‡æ–° fit | âœ… è¼‰å…¥è¨“ç·´ scaler | **æœ€é—œéµä¿®å¾©** |
| **å¹³ç§»æ“ä½œ** | âŒ æœ‰ | âœ… ç„¡ | ç§»é™¤éŒ¯èª¤æ“ä½œ |
| **hidden_size** | 256 | **384** | +50% å®¹é‡ |
| **num_layers** | 2 | **3** | æ›´æ·±ç¶²çµ¡ |
| **dropout** | 0.3 | **0.2** | ä¿ç•™æ›´å¤šä¿¡æ¯ |
| **fc_neurons** | [256,128,64,3] | **[512,256,128,64,3]** | 5å±¤å…¨é€£æ¥ |
| **å­¸ç¿’ç‡** | 0.0001 | **0.001** | 10å€æå‡ |
| **batch_size** | 128 | **256** | 2å€åŠ é€Ÿ |
| **epochs** | 1000 | **2000** | æ›´å……åˆ†è¨“ç·´ |
| **patience** | 50 | **100** | æ›´æœ‰è€å¿ƒ |
| **LR Scheduler** | âŒ ç„¡ | âœ… ReduceLROnPlateau | è‡ªé©æ‡‰å­¸ç¿’ç‡ |
| **lambda_velocity** | 0.5 | **0.3** | æ›´é—œæ³¨ä½ç½® |

---

## ğŸš€ ä½¿ç”¨æ­¥é©Ÿ

### 1ï¸âƒ£ é‡æ–°è¨“ç·´æ¨¡å‹ï¼ˆå¿…é ˆï¼ï¼‰

```powershell
cd c:\Users\USER\Desktop\Crossbows
python cnn_lstm/train.py
```

**ç‚ºä»€éº¼å¿…é ˆé‡æ–°è¨“ç·´ï¼Ÿ**
- ä¿®æ”¹äº†æ¨¡å‹çµæ§‹ï¼ˆhidden_size, num_layers, fc_neuronsï¼‰
- éœ€è¦ä¿å­˜æ–°çš„ scaler æ–‡ä»¶
- èˆŠæ¨¡å‹ç„¡æ³•è¼‰å…¥åˆ°æ–°çµæ§‹

### 2ï¸âƒ£ è¨“ç·´å®Œæˆå¾Œé æ¸¬

```powershell
python cnn_lstm/predict.py
```

---

## ğŸ¯ é æœŸæ”¹å–„

### Yaw è»¸ï¼ˆæœ€åš´é‡å•é¡Œï¼‰
- âŒ **ä¿®å¾©å‰**: å®Œå…¨å¹³å¦ï¼Œç„¡æ³•é æ¸¬
- âœ… **ä¿®å¾©å¾Œ**: èƒ½è·Ÿéš¨çœŸå¯¦å€¼çš„å¤§å¹…æ³¢å‹•

### Pitch è»¸
- âŒ **ä¿®å¾©å‰**: æ˜é¡¯æ»¯å¾Œ
- âœ… **ä¿®å¾©å¾Œ**: éŸ¿æ‡‰æ›´å¿«ï¼Œå¹…åº¦æ›´æº–ç¢º

### Roll è»¸
- âŒ **ä¿®å¾©å‰**: åŸºæœ¬è·Ÿéš¨ä½†æœ‰åå·®
- âœ… **ä¿®å¾©å¾Œ**: æ›´ç²¾ç¢ºçš„è·Ÿéš¨

---

## ğŸ“ˆ è©•ä¼°æŒ‡æ¨™é æœŸ

| æŒ‡æ¨™ | Yaw | Pitch | Roll |
|------|-----|-------|------|
| **MAE** | < 5.0 | < 3.0 | < 2.0 |
| **RMSE** | < 8.0 | < 5.0 | < 3.0 |

---

## âš ï¸ é‡è¦æé†’

### 1. å¿…é ˆé‡æ–°è¨“ç·´
èˆŠçš„æ¨¡å‹æ–‡ä»¶ `cnn_lstm_model.pth` èˆ‡æ–°çµæ§‹ä¸å…¼å®¹ï¼Œå¿…é ˆé‡æ–°è¨“ç·´ã€‚

### 2. æª¢æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
è¨“ç·´å®Œæˆå¾Œï¼Œæ‡‰è©²æœ‰ï¼š
```
RUN/train/
â”œâ”€â”€ cnn_lstm_model.pth          # æ¨¡å‹æ¬Šé‡
â”œâ”€â”€ feature_scaler.pkl          # âœ¨ æ–°æ–‡ä»¶
â””â”€â”€ target_scaler.pkl           # âœ¨ æ–°æ–‡ä»¶
```

### 3. è¨˜æ†¶é«”éœ€æ±‚
- æ–°æ¨¡å‹æ›´å¤§ï¼Œå¯èƒ½éœ€è¦æ›´å¤š GPU è¨˜æ†¶é«”
- å¦‚æœ OOMï¼Œé™ä½ `batch_size` åˆ° 128 æˆ– 64

### 4. è¨“ç·´æ™‚é–“
- é è¨ˆ 20-40 åˆ†é˜ï¼ˆå–æ±ºæ–¼ GPUï¼‰
- Early Stopping æœƒè‡ªå‹•åœæ­¢

---

## ğŸ” ç‚ºä»€éº¼æœƒå‡ºç¾é€™äº›å•é¡Œï¼Ÿ

### 1. Scaler ä¸ä¸€è‡´
é€™æ˜¯æ©Ÿå™¨å­¸ç¿’ä¸­æœ€å¸¸è¦‹çš„éŒ¯èª¤ä¹‹ä¸€ï¼š
- è¨“ç·´æ™‚ fit ä¸€æ¬¡
- é æ¸¬æ™‚åˆ fit ä¸€æ¬¡
- å°è‡´å…©æ¬¡çš„æ¨™æº–åŒ–ç¯„åœå®Œå…¨ä¸åŒ

### 2. éåº¦ä¿å®ˆçš„åƒæ•¸
- ç‚ºäº†é˜²æ­¢éæ“¬åˆï¼Œä½¿ç”¨äº†å¤ªå°çš„æ¨¡å‹
- ä½†å°æ–¼å¤§ç¯„åœçš„ Yaw è®ŠåŒ–ï¼Œéœ€è¦æ›´å¼·çš„è¡¨é”èƒ½åŠ›

### 3. éŒ¯èª¤çš„å¾Œè™•ç†
- å¹³ç§»æ“ä½œç ´å£äº†é æ¸¬çš„çµ•å°å€¼
- é€™åœ¨æ™‚åºé æ¸¬ä¸­æ˜¯å®Œå…¨éŒ¯èª¤çš„

---

## ğŸ“ å¦‚æœé‚„æœ‰å•é¡Œ

### Q1: è¨“ç·´å¾Œ Yaw é‚„æ˜¯å¹³çš„ï¼Ÿ
æª¢æŸ¥ï¼š
```python
# ç¢ºèª scaler å·²ä¿å­˜
import joblib
from pathlib import Path
scaler = joblib.load(Path('RUN/train/target_scaler.pkl'))
print(scaler.data_min_)    # æ‡‰è©²é¡¯ç¤º [Yaw_min, Pitch_min, Roll_min]
print(scaler.data_max_)    # æ‡‰è©²é¡¯ç¤º [Yaw_max, Pitch_max, Roll_max]
```

### Q2: GPU è¨˜æ†¶é«”ä¸è¶³
```python
# é™ä½åƒæ•¸
hidden_size = 256
batch_size = 64
```

### Q3: è¨“ç·´å¤ªæ…¢
```python
# é™ä½ epochs å’Œ patience
epochs = 1000
patience = 50
```

---

**ä¿®å¾©æ—¥æœŸ**: 2025å¹´10æœˆ31æ—¥  
**ç‹€æ…‹**: âœ… æº–å‚™å°±ç·’ï¼Œå¯ä»¥é–‹å§‹è¨“ç·´
